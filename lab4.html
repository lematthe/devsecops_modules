<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.11">
<title>Lab 4: Implementing DevSecOps to Build and Automate Security into the Application using Red Hat Advanced Cluster Security</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_lab_4_implementing_devsecops_to_build_and_automate_security_into_the_application_using_red_hat_advanced_cluster_security">Lab 4: Implementing DevSecOps to Build and Automate Security into the Application using Red Hat Advanced Cluster Security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lab_objective">Lab Objective</h3>
<div class="paragraph">
<p>The goal of this lab is to learn how to build a secure software factory that orchestrates a combination of different security tools. With the advent of DevSecOps, security is put front and center - it is addressed in terms of people, processes, and technology. Security tools are integrated right into the build process and we could easily break the build if security requirements are not met with the security gates that we build into the CI/CD pipeline.</p>
</div>
</div>
<div class="sect2">
<h3 id="_introduction">Introduction</h3>
<div class="paragraph">
<p>The benefits of <a href="https://www.redhat.com/en/topics/devops/what-is-devsecops">DevOps</a> and <a href="https://www.redhat.com/en/topics/devops/what-cicd-pipeline">Continuous Integration / Continuous Delivery (CI/CD)</a> have been demonstrated with great success over the years. Organizations have always sought to do more with less. Security was treated as an add-on to the end of the software delivery process in many cases, and it often delayed software delivery. The industry recognized that this had to change. Organizations must continue to meet contractual and regulatory obligations as well as internal security standards, but need to accelerate software delivery to capitalize on opportunities. To enable organizations to meet these standards and deliver at the speed of DevOps security has faced the choice of becoming irrelevant or molding to modern software delivery practices. Security is critical to deliver software quickly and has become a metric of software quality, so there was a push to include “Sec” in “DevOps.” With the advent of DevSecOps, Shift Left is a practice intended to find and prevent defects early in the software delivery process. Security tools are integrated directly into the build process. As a result, the CI/CD process can move faster and reduce the length of time to delivery while still continuously improving the quality of each release.<br>
This lab exercise will focus on some of technologies used to implement automated security compliance controls within a typical CI/CD application pipeline.<br>
A number of tools have been installed and pre-configured to support the DevSecOps pipeline. Most of these tools are running containerized within the Red Hat OpenShift cluster. Here is the pipeline we will be stepping through during our lab:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops01.png" alt="800" width="800"></span></p>
</div>
<div class="paragraph">
<p>In our DevSecOps CI/CD pipeline, we will be using several technologies such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.openshift.com/learn/topics/ci-cd">OpenShift Pipelines</a> based on <a href="https://tekton.dev">Tekton</a></p>
</li>
<li>
<p><a href="https://www.openshift.com/blog/announcing-openshift-gitops">OpenShift GitOps</a> based on <a href="https://argoproj.github.io/">ArgoCD</a></p>
</li>
<li>
<p><a href="https://www.redhat.com/en/resources/advanced-cluster-security-for-kubernetes-datasheet">Red Hat Advanced Cluster Security for Kubernetes</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/registry/architecture-component-imageregistry.html">OpenShift Container Registry</a></p>
</li>
<li>
<p><a href="https://www.sonarqube.org/">SonarQube</a></p>
</li>
<li>
<p><a href="https://www.sonatype.com/products/repository-oss?topnav=true">Nexus</a></p>
</li>
<li>
<p><a href="https://junit.org/junit5/">JUnit</a></p>
</li>
<li>
<p><a href="https://gogs.io/">Gogs</a></p>
</li>
<li>
<p><a href="https://tekton.dev/docs/triggers/">Git Webhook</a></p>
</li>
<li>
<p><a href="https://gatling.io/">Gatling</a></p>
</li>
<li>
<p><a href="https://www.zaproxy.org/">Zap Proxy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="beforeyoustart">Before you start</h3>
<div class="paragraph">
<p>The information from the instructor will be used in this lab:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to RHEL 8 VM (bastion) with username and password</p>
</li>
<li>
<p>OpenShift Console URL</p>
</li>
<li>
<p>OpenShift API server</p>
</li>
<li>
<p>OpenShift admin user password</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of the registration information:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops02.png" alt="800" width="800"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_user_requirements">User Requirements</h3>
<div class="ulist">
<ul>
<li>
<p>Up-To-Date Browser: Chrome and Firefox recommended</p>
</li>
<li>
<p>Command-line with ‘oc’ tool is included in the bastion VM that comes with the lab.</p>
<div class="ulist">
<ul>
<li>
<p>SSH into the assigned VM similar to the below command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code> ssh lab-user@bastion.GUID.sandbox####.opentlc.com</code></pre>
</div>
</div>
</li>
<li>
<p>To check if the oc command-line utility is available, open the terminal and run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code> oc version</code></pre>
</div>
</div>
</li>
<li>
<p>To get the console URL from command-line:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc login -u admin api.cluster-{GUID}.{GUID}.sandbox###.opentlc.com:6443</code></pre>
</div>
</div>
<div class="paragraph">
<p>API server information for ‘oc login’ can be found in the <a href="#beforeyoustart">Before You Start</a>.</p>
</div>
</li>
<li>
<p>Alternatively, if we want to setup oc client on our laptop, perform the following steps:</p>
<div class="ulist">
<ul>
<li>
<p>Log in to the OpenShift console. OpenShift console admin user password information is provided by the instructor.
Select the question mark in the top right corner and select “Command Line Tools”</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops03.png" alt="200" width="200"></span></p>
</div>
</li>
<li>
<p>Download the oc command-line tool for the operating system of your choice.</p>
</li>
<li>
<p>Move the oc command-line tool to the system executables location for simplicity of access throughout the exercise.</p>
<div class="paragraph">
<p>For example, on Macbook, run the command</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv &lt;insert-download-path&gt; /usr/local/bin /usr/local/bin/</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</li>
<li>
<p>Internet access to the lab environment</p>
</li>
<li>
<p>Internet access to GitHub</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_lab_4_1_continuous_integration">Lab 4.1 Continuous Integration</h3>
<div class="paragraph">
<p>This first module will run an OpenShift Pipeline and let us explore the steps in a sample secure pipeline.<br>
In this lab, we will learn how to start the Tekton pipeline and how to use the tasks to integrate the security and gitops tools within the development lifecycle.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>There are three ways to start the pipeline:</p>
<div class="ulist">
<ul>
<li>
<p>Option 1: Use Developer UI to start</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Browse to the OpenShift Console URL in the browser</p>
</li>
<li>
<p>Log in to the console using the provided credentials</p>
</li>
<li>
<p>If we are not already in the Developer Perspective, select Developer to switch to the developer console in the top left corner.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops04.png" alt="200" width="200"></span></p>
</div>
</li>
<li>
<p>Navigate to the “ocp-workshop” project</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops05.png" alt="200" width="200"></span></p>
</div>
</li>
<li>
<p>Click 'Pipelines' on the left menu to view all pipelines</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops06.png" alt="400" width="700"></span></p>
</div>
</li>
<li>
<p>Click onto the “petclinic-build-dev” pipeline</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops07.png" alt="600" width="800"></span></p>
</div>
</li>
<li>
<p>From the top right corner, click “Actions” → “Start” - a "Start Pipeline" screen will pop up</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops08a.png" alt="400" width="600"></span></p>
</div>
</li>
<li>
<p>Under “Workspaces”, select PVC and then choose the PVC petclinic-build-workspace as the shared storage path that the pipelines will use at runtime. Under “maven-settings” select Config Map and choose “maven-settings” as the Config Map</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops08b.png" alt="400" width="600"></span></p>
</div>
</li>
<li>
<p>Click <code>Start</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Option 2: Use Command line to start the pipeline
The command-line is a convenient way to start the pipeline while testing, and it is a way to simulate a PR or push to git and trigger the pipeline. It is for users who prefer the CLI to start the pipeline.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Run:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">oc create -f <a href="https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/pipeline-build-dev-run.yaml" class="bare">https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/pipeline-build-dev-run.yaml</a> -n ocp-workshop</th>
</tr>
</thead>
</table>
</li>
</ol>
</div>
</li>
<li>
<p>Option 3: When new code is pushed to the git repo, it will also trigger the pipeline to start. In this lab, git repo is Gogs. The steps below are for pushing code via the “Gogs” git repo.
This option may be the most popular from a developer perspective. The pipeline starts from a PR or a push into the git repo and the webhook automatically starts the pipeline.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the Dev console, click <code>Search</code> on the left nav menu.</p>
</li>
<li>
<p>Type 'route' and click <code>Route</code> from the list.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops09.png" alt="400" width="400"></span></p>
</div>
</li>
<li>
<p>Click the <code>Gogs</code> route to open the Gogs repo URL:</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops10.png" alt="400" width="600"></span></p>
</div>
</li>
<li>
<p>Click on the <code>Sign In</code>, to log in with the <em>gogsadmin</em> credentials:</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops11.png" alt="500" width="400"></span></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User: gogsadmin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password: openshift</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Select the spring-petclinic repository inside of the gogsadmin account:</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops12.png" alt="400" width="700"></span></p>
</div>
</li>
<li>
<p>Click into the README.md, click in <code>Edit this file</code> and introduce a change:</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops13.png" alt="400" width="700"></span></p>
</div>
</li>
<li>
<p>Commit the change that we introduced into the README.md:</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops14.png" alt="400" width="700"></span></p>
</div>
<div class="paragraph">
<p>[Note] This event based integration is only for demo purposes. Usually direct code push to master is not recommended, and it’s a Pull / Merge Request from another branch (such as develop) that is used instead.</p>
</div>
</li>
<li>
<p>The pipeline will be triggered automatically, please skip to step 6 of this lab to see the Pipeline Runs console.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Open the browser using the provided OpenShift console URL.</p>
</li>
<li>
<p>Log in to the console using the provided credentials.</p>
</li>
<li>
<p>Click to <code>Developer</code> to switch to Developer&#8217;s console.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops04.png" alt="200" width="200"></span></p>
</div>
</li>
<li>
<p>Make sure the <code>ocp-workshop</code> project is selected.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops15.png" alt="300" width="300"></span></p>
</div>
</li>
<li>
<p>Click <code>Pipelines</code> on the left menu to view all pipelines.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops16.png" alt="400" width="700"></span></p>
</div>
</li>
<li>
<p>Click onto Pipeline <code>petclinic-build-dev</code> and click onto the <code>Pipeline Runs</code> tab.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops17.png" alt="400" width="700"></span></p>
</div>
</li>
<li>
<p>Click onto the Pipeline Run.</p>
<div class="paragraph">
<p>Please see the Pipeline Run as shown below when it starts.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops18.png" alt="500" width="700"></span></p>
</div>
<div class="paragraph">
<p>The pipeline run will fail at step “image-check” in the pipeline run. This is due to an Important severity level vulnerability in the image detected by a pipeline gate policy, stopping the deployment.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops20.png" alt="500" width="700"></span></p>
</div>
<div class="paragraph">
<p>This vulnerability has to be fixed for the pipeline to complete successfully - we will do it in the next module. Here is what a successfully completed pipeline run looks like.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops19.png" alt="500" width="700"></span></p>
</div>
<div class="paragraph">
<p>The next module Lab 4.2 will walk through what’s happened and how to resolve it securely.</p>
</div>
<div class="paragraph">
<p>[Note] In addition to triggering a pipeline run manually, every push to the <code>spring-petclinic</code> Git repository on the Gogs server kicks it off via configured Pipeline triggers.</p>
</div>
</li>
<li>
<p>Explore the pipeline! Once the pipeline is started, we can click on each detailed step to explore its logs. We’ll direct some of the explorations in the next few steps.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Source Clone</strong> - app source code is pulled from the Git (Gogs) server installed in this Lab.</p>
<div class="paragraph">
<p>[Note] Files persist between steps in the pipeline via workspace (PVC) that is pre-defined in the pipeline.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops24.png" alt="400" width="700"></span></p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Copy the Git repo URL. Open a browser tab to explore the code</p>
</li>
<li>
<p>The URL takes us to the Gogs git repo as shown below.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops25.png" alt="600" width="700"></span></p>
</div>
</li>
<li>
<p>Click onto <code>gogsadmin</code> - there are 2 repositories for this Lab.</p>
<div class="paragraph">
<p>The credentials for <code>gogsadmin</code> user are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User: gogsadmin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pass: openshift</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Dependency Report</strong> is a step in the pipeline that creates a report of the app dependencies from the source code and uploads it to the report server repository.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops26.png" alt="300" width="700"></span></p>
</div>
<div class="paragraph">
<p>Let’s look at the report!</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>From the dev console, click <code>Search</code> on the left nav menu</p>
</li>
<li>
<p>Click Resources, type <code>route</code>, and click <code>Route</code> from the list</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops09.png" alt="400" width="400"></span></p>
</div>
</li>
<li>
<p>Click on the reports repo link</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops27.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click onto the <code>petclinic-build</code> link from the page</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops28.png" alt="300" width="500"></span></p>
</div>
</li>
<li>
<p>Continue to click on spring-petclinic → target → site</p>
</li>
<li>
<p>Click on the <code>Dependencies</code> from the page. We may examine the details from that page by scrolling down</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops29.png" alt="300" width="700"></span></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Unit tests</strong> task is executed in parallel with dependency report.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops30.png" alt="300" width="700"></span></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Release-app</strong> is where<strong> </strong>the application is packaged as a JAR archive and released to Sonatype Nexus snapshot repository.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops31.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p><strong>Build-image</strong> step is when a container image is built in DEV/QA environments using S2I, pushed to OpenShift internal registry, and tagged with <code>spring-petclinic:[branch]-[commit-sha]</code> and <code>spring-petclinic:latest</code> tags.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops32.png" alt="300" width="700"></span></p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_lab_4_2_devsecops_integration_with_advanced_cluster_security">Lab 4.2 DevSecOps - Integration with Advanced Cluster Security</h3>
<div class="paragraph">
<p>Red Hat Advanced Cluster Security (ACS) for Kubernetes controls clusters and applications from a single console, with built-in security policies.<br>
First-generation container security platforms focus on the container. ACS’s focus on Kubernetes helps DevOps and Security teams operationalize security, with a Kubernetes-native architecture that leverages K8s declarative data and built-in controls for richer context, native enforcement, and continuous hardening. In addition, ACS focuses on Kubernetes helps DevOps and Security teams operationalize security, simplifying the process of protecting the cloud-native application stack.</p>
</div>
<div class="paragraph">
<p>In this lab, we will learn how ACS integrates into the CI/CD process. ACS not only simplifies that process but provides visibility to the Security team in our organization.
Using <a href="https://docs.openshift.com/acs/cli/getting-started-cli.html">roxctl</a> and ACS API, we integrated several additional security steps into our DevSecOps pipeline:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <strong>image scan</strong> step uses the ACS Scanner to scan the image built and pushed into internal repository in the previous step.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops33.png" alt="300" width="700"></span></p>
</div>
<div class="paragraph">
<p>The error below in the log is caused by the <code>pretty</code> output format parameter that is deprecated.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR:	invalid output format "pretty" used. You can only specify json or csv</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To change the format you can do the steps below.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <code>Pipelines</code> on the left menu</p>
</li>
<li>
<p>Click onto the <code>petclinic-build-dev</code> pipeline</p>
</li>
<li>
<p>Select <code>Actions</code> &#8594; <code>Edit Pipeline</code></p>
</li>
<li>
<p>Click onto the <code>image-scan</code> task and use <code>csv</code> for output format instead of <code>pretty</code></p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4.2-image-scan.png" alt="500" width="700"></span></p>
</div>
</li>
<li>
<p>Click <code>Save</code></p>
</li>
<li>
<p>Optionally select <code>Actions</code> &#8594; rerun and you will see the actual output of the image-scan.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4.2-image-scan-withlogs.png" alt="500" width="700"></span></p>
</div>
<div class="paragraph">
<p>In the log of this step, there is a URL link to the image scan in ACS.</p>
</div>
<div class="paragraph">
<p>[Note] If we see a security certificate warning proceeding to that link, ignore it.<br>
Copy and paste URL into another tab in order to get more information about the scanned image - it would open ACS Central login screen Enter the following information:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User: admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pass: stackrox</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The URL takes us to Vulnerability Management. Here is an overview of the vulnerabilities (CVEs) found in this image:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops35.png" alt="500" width="700"></span></p>
</div>
</li>
<li>
<p>Under the Deployment tab
The ACS tool is aware of if this image is deployed. Since the first pipeline didn’t pass all of its gates and image was not pushed, at first there will be no deployments displayed.</p>
</li>
<li>
<p>Under the Component tab
This is a view of all of the components in this image. It lists relevant information such as the number of CVEs that can be fixed with an upgrade of the component, top CVSS score associated with any of the CVEs in the component, and other deployments that include each component.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops34.png" alt="500" width="700"></span></p>
</div>
<div class="paragraph">
<p>For example, if we click on the tomcat 9.0.31 component, we will see the details of the component as shown below. This page shows the risk priority, the CVE&#8217;s information, the location of the component, and the version of the component to upgrade to in order to remediate the CVE.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4.2-tomcat-cve.png" alt="500" width="700"></span></p>
</div>
</li>
<li>
<p>Click “X” on the top right to go back</p>
</li>
<li>
<p>CVEs tab presents a view of all vulnerabilities of the image</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops36.png" alt="500" width="700"></span></p>
</div>
</li>
<li>
<p>Go back to the <code>Overview</code> tab, and scroll down to the <code>Image findings</code> section, we will see the fixable CVEs. These are CVEs where ACS knows there are fixes available.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops37.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click '&gt;' to expand <code>Dockerfile</code> section above the <code>Image Findings</code> section, the detailed image components and related CVEs are shown per each step, per the ACS CVE database.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops38.png" alt="400" width="700"></span></p>
</div>
<div class="paragraph">
<p>Feel free to continue to explore ACS before continuing to review the pipeline. Understanding security checks and tool capabilities are a key part of this lab and can help raise the knowledge of a secure software delivery pipeline.</p>
</div>
<div class="paragraph">
<p>Now, go back to OpenShift Developer console.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>The <strong>Image Check</strong> step of the pipeline</p>
<div class="paragraph">
<p>[Note] The build-time violations of the different security policies defined in ACS.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops39.png" alt="400" width="700"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops40.png" alt="400" width="700"></span></p>
</div>
<div class="paragraph">
<p>This step checks build-time and deploy-time violations of security policies defined in ACS for any deployment that uses this image. Due to security policy violations, this pipeline fails at this task because we set security Policy enforcement in ACS.
Scanning images is critical to prevent highly vulnerable containerized applications from deployment.</p>
</div>
</li>
<li>
<p><strong>Deploy-check</strong> shows the violation of the policies in the log. The log shows the violations, but it did not fail at this task because the deployment enforcement is not on in this example. We will explore more on the policy in the later lab.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops41.png" alt="400" width="700"></span></p>
</div>
<div class="paragraph">
<p>[Note] These 3 steps (<strong>deploy-check, image-check, and image-scan</strong>) are executed in parallel to save time in our DevSecOps pipeline.</p>
</div>
</li>
<li>
<p>If <strong>image-check</strong> fails, go to the pipeline run and click <code>image-check</code>. The bottom of the log shows <code>Error: failed policies found: 1 policy violated that are failing the check.</code> The reason for the error is because ACS enforces the policy from building and deploying if a violation occurs. The pipeline integrates ACS via the <code>roxctl</code> CLI in Tekton pipeline tasks.</p>
<div class="paragraph">
<p>When an image violates the policies, the best practice is to fix the code and execute the pipeline until it passes the checks. The logs reported the list of violations and remediation. Developers can take the information from the <code>image-check</code> task’s log and make changes accordingly. When the fix is checked into Git, the pipeline will be triggered. We have prepared the <a href="#fiximage">bonus exercise for fixing the image</a>. If we would like to continue to test other tasks on the pipeline, we can add an exception to the policy to exclude the <code>spring-petclinic</code>.
Adding an exception to a policy can be useful when developers need to fix the code, and the CI process needs to continue the testing.</p>
</div>
<div class="paragraph">
<p>[Note] Please be aware that fixing the image source code to remove such violations will be the recommended approach.</p>
</div>
<div class="paragraph">
<p>Assuming that we will add an exception to bypass the policy for <code>spring-petclinic</code> image build.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>When we inspect the log from the <strong>image-check</strong> task, we will find the below message which caused the failure:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">✗ Image image-registry.openshift-image-registry.svc:5000/ocp-workshop/spring-petclinic@sha256:ece54d2923654c36f4e97bc0410f5c027871c5b7483e977cfc6c2bd56fef625d and '<strong>ERROR: Policy "Fixable Severity at least Important"</strong>'</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click <code>waffle icon</code> <span class="image"><img src="images/lab4-devsecops42.png" alt="20" width="20"></span> to get the console links → select <code>Red Hat Advanced Cluster Security For Kubernetes</code> as shown below.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops43.png" alt="700" width="300"></span></p>
</div>
</li>
<li>
<p>You will be prompted to log in to the ACS console → click <code>Advanced</code> → <code>Proceed to central-stackrox.apps.cluster&#8230;&#8203;</code> link to proceed.</p>
</li>
<li>
<p>Enter the following login credentials:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User: admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pass: stackrox</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click <code>Login</code> - you should land on the ACS page as shown below.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops44.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click <span class="image"><img src="images/lab4-devsecops45.png" alt="20" width="20"></span> on the top left → click Platform Configuration → select Policies</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops46.png" alt="100" width="200"></span></p>
</div>
</li>
<li>
<p>Under Policies, put the policy name <strong>Fixable Severity at least Important</strong> in the search field and hit Enter. The policy will list as the result.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops47.png" alt="300" width="700"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click onto <code>Fixable Severity at least Important</code> to open Policy details page. The Policy page allows Edit, Clone, Export and Disable policy under <code>Actions</code>. Click 'Edit policy' under <code>Actions</code>. Developers can use the information in the guidance to fix the image. The lifecycle stage information is where the policy enforcement takes place. Since the enabled policy is violated, it will not pass the Build and Deploy stages in the pipeline.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops48_new.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click <code>Next</code> on <code>Policy Details</code></p>
</li>
<li>
<p>Click <code>Next</code> on <code>Policy Behavior</code></p>
</li>
<li>
<p>Click <code>Next</code> on <code>Policy Criteria</code>  in order to get to the <code>Policy Scope</code> section to specify the image to be excluded from scanning</p>
</li>
<li>
<p>In the Exclude Images section, type the following to filter the options in the <code>Excluded Images (Build Lifecycle only)</code> list:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image-registry.openshift-image-registry.svc:5000/ocp-workshop/spring-petclinic</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Select the `Create "image-registry.openshift-image-registry.svc:5000/ocp-workshop/spring-petclinic" option.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4.2-5-exclude-image_new.png" alt="200" width="500"></span></p>
</div>
</li>
<li>
<p>Click <code>Next</code></p>
</li>
<li>
<p>Please review Policy Summary before clicking <code>Save</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Now, the updated <code>Fixable Severity at least Important</code> policy with excluded image is shown below:</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4.2-5-2Policy_new.png" alt="200" width="500"></span></p>
</div>
</li>
<li>
<p>Switch back to the OpenShift Developer console, and select the failing Pipeline on the nav under “ocp-workshop” project</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops52.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Rerun the pipeline</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops53.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click onto the Pipeline Runs tab and select the one just started - it should now complete successfully</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops54.png" alt="300" width="700"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops55.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>[Notes]: There still are warnings for other, non-critical, ACS Policy violations in the <code>image-scan</code> step, but they don&#8217;t block the pipeline from completion</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops55a.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>If you finish the <a href="#fiximage">bonus lab</a> to fix the source image vulnerability, go back to the above Policy and remove the excluded <code>spring-petclinic</code> image from there.</p>
</li>
<li>
<p>Kubernetes kustomization files are updated in the <strong>update deployment step</strong> with the latest image [commit-sha] in the overlays for dev. This will ensure that our applications are deployed using the specific built/tagged image in this pipeline.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops56.png" alt="300" width="700"></span></p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_lab_4_3_continuous_application_delivery_using_gitops">Lab 4.3 Continuous Application Delivery Using GitOps</h3>
<div class="paragraph">
<p><a href="https://www.redhat.com/en/topics/devops/what-is-gitops">GitOps</a> is a declarative way to implement continuous deployment for Cloud-native applications. We can use GitOps to create repeatable processes for managing OpenShift Container Platform clusters and applications across multi-cluster Kubernetes environments. GitOps handles and automates complex deployments at a fast pace, saving time during deployment and release cycles.<br>
The GitOps workflow pushes an application through development, testing, staging, and production. GitOps either deploys a new application or updates an existing one, so we only need to update the repository; GitOps automates everything else.</p>
</div>
<div class="paragraph">
<p><a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD</a> continuously monitors the configurations stored in the Git repository and uses <a href="https://kustomize.io/">Kustomize</a> to overlay environment-specific configurations when deploying the application to DEV and STAGE environments.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops57.png" alt="300" width="700"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The ArgoCD application syncs the manifests in our Gogs git repositories, and applies the changes automatically into the namespaces defined:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click on the waffle icon on the top to get to the console links and select “Cluster Argo CD”</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops43.png" alt="300" width="300"></span></p>
</div>
</li>
<li>
<p>The link redirects to the Argo CD login. If it is the first time logging in to Argo CD, please click <code>Advanced</code> → <code>Proceed to openshift-gitops-server-openshift-gitops.apps…</code> link.</p>
</li>
<li>
<p>In order to be able to log in as an "admin" user, please first retrieve its password by running the command as shown below.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc get secret/openshift-gitops-cluster -n openshift-gitops -o jsonpath='{.data.admin\.password}' | base64 -d</code></pre>
</div>
</div>
</li>
<li>
<p>Once logged in, the applications are listed on the Argo CD console as shown below.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops58.png" alt="500" width="600"></span></p>
</div>
</li>
<li>
<p>Click onto <code>dev-spring-petclinic</code> to access the application.</p>
</li>
</ol>
</div>
</li>
<li>
<p>ArgoCD will deploy every manifest that is defined in the branch/repo of our application. The application shows “Synced”.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops59.png" alt="300" width="700"></span></p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <span class="image"><img src="images/lab4-devsecops101.png" alt="100" width="90"></span> to view the details of the <code>dev-spring-petclinic</code> application.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops102.png" alt="900" width="700"></span></p>
</div>
</li>
<li>
<p>The details above show the namespace where the application is deployed. Back to the OpenShift Dev console, click <code>Topology</code> on the left navigation menu under devsecops-dev project. Click the arrow to access the application URL.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops60.png" alt="300" width="500"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application shows as below.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops61.png" alt="500" width="500"></span></p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Go back to the Argo CD console. Click <code>Applications</code> on the top left.</p>
<div class="paragraph">
<p>[Note] The namespace for <code>stage-spring-petclinic</code> is set to <code>devsecops-qa</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops62.png" alt="300" width="300"></span></p>
</div>
</li>
<li>
<p>Click <code>stage-spring-petclinic</code></p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops63.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click <span class="image"><img src="images/lab4-devsecops64.png" alt="40" width="50"></span> on the top menu to deploy the application to <code>devsecops-qa</code> namespace and wait until “Synced” as shown below.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops65.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Back to the OpenShift Dev console, click <code>Topology</code> on the left navigation menu under devsecops-qa project. Click the arrow to access the application URL.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops66.png" alt="300" width="300"></span></p>
</div>
</li>
<li>
<p>The application is now deployed to the <code>devsecops-qa</code> project as shown below:</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops67.png" alt="300" width="500"></span></p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_lab_4_4_post_ci_dynamic_application_security_and_testing_dast">Lab 4.4 Post CI - Dynamic Application Security and Testing (DAST)</h3>
<div class="paragraph">
<p><strong>Dynamic application security testing (DAST)</strong> is designed to detect conditions indicative of a security vulnerability in an application in its running state. DAST has an important role in helping to identify vulnerabilities in applications during production. Running DAST penetration tests enables us to find those vulnerabilities before an attacker does!
In this lab, ZAP is used to perform application security testing as an example. Performance tests and penetration tests start in parallel after the application is promoted from Dev to QA.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Our CI in Openshift Pipelines waits until the app is fully synced via ArgoCD (<strong>Wait Application step</strong>) and all related resources are deployed</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to the successful pipeline run, and examine the step <strong>wait-application</strong></p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops68.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click onto the step, the log is shown below.</p>
<div class="paragraph">
<p>This step authenticates into an ArgoCD instance and initiates the synchronization process for 'dev-spring-petclinic' application from Git repo (gogs) to the target project in the OCP cluster.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops69.png" alt="300" width="700"></span></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click on the pipeline the step <strong>perf-test-clone</strong></p>
<div class="paragraph">
<p>The performance tests are cloned (<strong>Performance Tests Clone</strong>) into our pipeline workspace as shown below.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops70.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click onto step <strong>pentesting-test</strong></p>
<div class="paragraph">
<p>The pentesting step (<strong>Pentesting Test</strong>) is executed by the web scanner <a href="https://www.zaproxy.org/">OWASP Zap Proxy</a> using a baseline to check the possible vulnerabilities. A Zap Proxy report is uploaded to the report server repository.
See the result from the bottom of the log.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops72.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>A performance report is uploaded to the Report server repository.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <code>Route</code> on the left navigation, click <code>reports-repo</code> route location.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops73.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>The link has the name that corresponds to the name of the PipelineRun.</p>
</li>
<li>
<p>Please click on the link with the same name as the PipelineRun. A similar link is shown below.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops75.png" alt="300" width="400"></span></p>
</div>
</li>
<li>
<p>Go to petclinic-build-dev-XXXXXX.html under the route location</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops76.png" alt="300" width="700"></span></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>In parallel, the performance tests are executed using the load tests via <a href="https://gatling.io/">Gatling</a>. Click “performance-test” from the pipeline run.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops77.png" alt="300" width="700"></span></p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Scroll down to see the report location</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops78.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Go back to the report repo location:</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops79.png" alt="300" width="400"></span></p>
</div>
</li>
<li>
<p>Click on the link that matches the name of Pipeline Run, then select the link corresponding to the "addvisitsimulation" performance test that is also shown in the <code>performance-test</code> task log.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops80.png" alt="200" width="400"></span></p>
</div>
</li>
<li>
<p>Please see the result of the performance test page similar to the image below.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops81.png" alt="400" width="700"></span></p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_lab_4_5_acs_security_policies_and_ci_violations">Lab 4.5 ACS Security Policies and CI Violations</h3>
<div class="paragraph">
<p>In this demo, we can control the security policies applied to our pipelines, scan the images, and analyze the different deployment templates used to deploy our applications.<br>
We can enforce the different Security Policies in ACS, failing our CI pipelines if a violation of this policy appears in each step of our DevSecOps pipelines (steps “image-check”, “image-scan”, “deploy-check”).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on the <code>waffle icon</code> and select <code>Red Hat Advanced Cluster Security for Kubernetes</code></p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops43.png" alt="300" width="300"></span></p>
</div>
</li>
<li>
<p>Log in using credentials <code>admin/stackrox</code> to ACS console.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops82.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click <code>Platform Configuration</code> → <code>Policies</code></p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops83.png" alt="200" width="200"></span></p>
</div>
<div class="paragraph">
<p>Security Policies can be defined at the BUILD (during the build/push of an image), or at the DEPLOYMENT level (controlling deployment of an application).</p>
</div>
</li>
<li>
<p>Click on the <code>Red Hat Package manager in Image</code> policy</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops84.png" alt="300" width="700"></span></p>
</div>
<div class="paragraph">
<p>For example, this Security Policy checks if an RH Package Manager (dnf, yum) present in an application Image and will FAIL the pipeline if it detects that an Image built contains any RH Package Manager.</p>
</div>
</li>
<li>
<p>The policy details can be modified. Also, the lifecycle stages are defined in the policy and other properties. The enablement of Policy options is where the user controls CI pass/fail conditions based on policy</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops85.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click <code>Actions</code> &#8594; <code>Edit policy</code></p>
</li>
<li>
<p>Click <code>Next</code> on <code>Policy Details</code></p>
</li>
<li>
<p>Select <code>Inform and enforce</code> under Response method</p>
</li>
<li>
<p>Select <code>Enforce on Build</code> for Build</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops87.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click <code>Next</code> 3 times and <code>Save</code>
This policy enforcement ensures that DevOps team has full control of SDLC: no image is pushed into the Image registry or deployed to the cluster that fails to comply with defined Security Policies.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="fiximage">Bonus Exercise for Lab 4.2: Fixing the source image</h3>
<div class="paragraph">
<p>To show a complete DevSecOps demo and show the transition from a "bad image" to one that passes the Build security policy check, we can update the Pipeline task of the image build and fix the image source.
In this example, we will be enabling the <code>Red Hat Package Manager in Image</code> policy in ACS, which will initially fail our pipeline at the image-check as both yum and rpm package managers are present in our base image.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add an exception to bypass the violation in the <strong>Fixable Severity at least Important</strong> policy as we did in the previous section.</p>
</li>
<li>
<p>Enable enforcement of the <strong>Red Hat Package Manager in Image</strong> policy:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to <code>Platform Configuration</code> → <code>Policies</code></p>
</li>
<li>
<p>Search for <code>Red Hat Package Manager in Image</code> policy</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops88.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Click onto the <code>Red Hat Package Manager in Image</code> policy</p>
</li>
<li>
<p>Click <code>Actions</code> &#8594; <code>Edit Policy</code></p>
</li>
<li>
<p>Click <code>Next</code></p>
</li>
<li>
<p>Select <code>Inform and enforce</code> in Response method</p>
</li>
<li>
<p>Ensure selection of <code>Enforce on Build</code> in Build under <code>Configure enforcement behavior</code> section</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops87.png" alt="300" width="600"></span></p>
</div>
</li>
<li>
<p>Click <code>Next</code> until reaching <code>Review policy</code> page</p>
</li>
<li>
<p>Click <code>Save</code> (if any modification apply)</p>
</li>
<li>
<p>Go to the OpenShift Dev UI, click Pipelines on the left → click <code>petclinic-build-dev</code> pipeline → click <code>Actions</code> on the top right corner → select <code>Start last run</code> to re-run pipeline with same parameters</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops91.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Check and confirm that pipeline fails on the <strong>image-check</strong> step as the built image has the "rpm" and "yum" package managers installed. Notice the suggestion from the <strong>image-check</strong> step:</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops92.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>We will effectively update the image following this remediation suggestion.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Instead of updating the <code>s2i-java-11</code> Tekton pipeline task that actually builds the image, we are replacing it with a corrected version.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the OpenShift Administrator UI, make sure the <code>ocp-workshop</code> project is selected before going to Pipelines &#8594; Tasks and delete the <code>s2i-java-11</code> task.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops93.png" alt="300" width="700"></span></p>
</div>
</li>
<li>
<p>Or from the pipeline Tekton cli</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tkn task delete s2i-java-11</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the new update task from the command terminal:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubectl apply -f <a href="https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml" class="bare">https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml</a> --namespace=ocp-workshop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">or, using OpenShift CLI:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oc apply -f <a href="https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml" class="bare">https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml</a>  -n ocp-workshop</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Re-run the pipeline that previously failed - the deployment now succeeds, congratulations to the developers!</p>
</li>
<li>
<p>The pipeline  <strong>image-check</strong> task run result will be similar to the one below.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-bonus-result.png" alt="300" width="700"></span></p>
</div>
<div class="paragraph">
<p>[Note] Please examine the contents of <a href="https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml" class="bare">https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml</a><strong class="<strong>labs-artifacts/s2ijava-mgr.yaml"></strong> </strong>file for more details on how the image was fixed.
We have added a step to the build task, using <a href="https://buildah.io/">buildah</a> CLI tool to remove the problematic package managers from the image (search for "rpm" or "yum" in the file).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops94.png" alt="300" width="700"></span></p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_bonus_exercise_defer_cves_or_mark_as_false_positive">Bonus Exercise: Defer CVEs or Mark as "False Positive"</h3>
<div class="paragraph">
<p>If we just want to <code>snooze</code> policy violations for particular CVEs instead of fixing problematic images and/or adding exceptions for build/deploy stages (e.g. to be able to test a pipeline end-to-end). ACS allows users to temporarily disable CVEs violation for a period of time.</p>
</div>
<div class="paragraph">
<p>[Note] Deferring CVEs would disable violation notifications for those CVE for ALL policies that include it.</p>
</div>
<div class="paragraph">
<p>For this lab, we can defer the CVEs that cause the image-check to fail and continue to build the pipeline. We will see that <strong>image-check</strong> task is reporting some Fixable violations information from the pipeline task log:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops95.png" alt="300" width="700"></span></p>
</div>
<div class="paragraph">
<p>In some situations, we may want to defer triggering of certain CVEs for a period of time. Here are the steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the ACS console via the <code>waffle icon</code> and click on the <code>Red Hat Advanced Clustered Security for Kubernetes</code> link.
Click Vulnerability Management left menu and click on the CVEs button  on the top.</p>
</li>
<li>
<p>Look for the detected CVEs and request Deferral by selecting the duration needed (Until Fixable, 2 Weeks, 30 Days, 90 Days, Indefinite).</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops96_new.png" alt="300" width="700"></span></p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Submit a request for selected Deferral period or marking as <code>False positive</code> (exclusion of specified CVEs from policy violations if determined as such)</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops96a.png" alt="200" width="500"></span></p>
</div>
</li>
<li>
<p>Upon approval by your Security lead (via Risk Acceptance menu), policy violations for selected CVE  will be deferred for selected period of time or permanently, depending on request</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops96b.png" alt="300" width="700"></span></p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_bonus_exercise_acs_notifications">Bonus Exercise: ACS Notifications</h3>
<div class="paragraph">
<p>ACS Central can be integrated with several Notifiers for alerting DevOps users when certain security events occur in managed clusters. In our Lab, we integrate with Slack to receive notifications when some Policies are violated to have more useful information:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops97.png" alt="300" width="500"></span></p>
</div>
<div class="paragraph">
<p>These policy notifications can be configured for each system policy enabled in our ACS Central, so we can create our own notification baselines in order to have only the proper information received in our systems.<br>
Here are the steps to set up slack integration with ACS based on the official <a href="https://docs.openshift.com/acs/3.70/integration/integrate-with-slack.html/">Integrate with Slack</a> documentation in ACS.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Slack App, enable Incoming Webhooks and get the Webhook URL using instruction <a href="https://docs.openshift.com/acs/3.70/integration/integrate-with-slack.html#configure-slack_integrate-with-slack">here</a></p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-slack.png" alt="300" width="500"></span></p>
</div>
</li>
<li>
<p>Select <code>Platform Configuration</code> &#8594; <code>Integration</code></p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops98.png" alt="100" width="300"></span></p>
</div>
</li>
<li>
<p>Click <code>Slack</code> and Click <code>New integration</code></p>
</li>
<li>
<p>Enter Slack App channel information in the form below.</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-slack-int.png" alt="100" width="300"></span></p>
</div>
</li>
<li>
<p>Enable the Notifications in the system policies: Select <code>Platform Configuration</code> &#8594; <code>Policies</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select a Policy &#8594; Click <code>Actions</code> &#8594; <code>Edit policy</code></p>
</li>
<li>
<p>Select checkbox next to <code>Slack Notifier</code> in the Attach Notifiers section of Policy details screen, click <code>Next</code> a few times and Save policy.</p>
</li>
<li>
<p>You should be getting notifications when this policy violation is triggered</p>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops99.png" alt="300" width="700"></span></p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_lab_troubleshooting_tips">Lab Troubleshooting Tips</h3>
<div class="sect3">
<h4 id="_code_analysis_failures">Code Analysis Failures</h4>
<div class="ulist">
<ul>
<li>
<p>Issue:
Sometimes Code Analysis raises an error when mvn is running the maven install 'sonar:sonar':</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[[1;31mERROR[m] Failed to execute goal+
[32morg.apache.maven.plugins:maven-compiler-plugin:3.8.1:testCompile[m [1m(default-testCompile)[m on
project [36mspring-petclinic[m: [1;31mCompilation failure[m
[[1;31mERROR[m]
[1;31m/workspace/source/spring-petclinic/src/test/java/org/springframework/samples/petclinic/service/ClinicServiceTests.java:[30,51]
cannot access org.springframework.samples.petclinic.owner.Pet[m
[[1;31mERROR[m] [1;31m  bad class file:
/workspace/source/spring-petclinic/target/classes/org/springframework/samples/petclinic/owner/Pet.class[m
[[1;31mERROR[m] [1;31m    class file contains wrong class:
org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest[m
[[1;31mERROR[m] [1;31m    Please remove or make sure it appears in the correct subdirectory of the
classpath.[m
[[1;31mERROR[m] [1;31m[m
[[1;31mERROR[m] -&gt; [1m[Help 1][m
[[1;31mERROR[m]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Resolution:
Just rerun the pipeline and will succeed without changing anything additional. The results will succeed afterward:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>[[1;34mINFO[m] Analyzed bundle 'petclinic' with 20 classes+
[[1;34mINFO[m] Analyzed bundle 'petclinic' with 20 classes
[[1;34mINFO[m]
[[1;34mINFO[m] [1m--- [0;32mmaven-jar-plugin:3.1.2:jar[m [1m(default-jar)[m @
[36mspring-petclinic[0;1m ---[m
[[1;34mINFO[m]
[[1;34mINFO[m] [1m--- [0;32mspring-boot-maven-plugin:2.2.5.RELEASE:repackage[m [1m(repackage)[m @
[36mspring-petclinic[0;1m ---[m
[[1;34mINFO[m] Replacing main artifact with repackaged archive
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] [1;32mBUILD SUCCESS[m
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] Total time: 01:55 min
[[1;34mINFO[m] Finished at: 2021-07-23T07:37:09Z
[[1;34mINFO[m] Final Memory: 118M/1245M
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_junit_tests_failures">JUnit Tests Failures</h4>
<div class="paragraph">
<p>Refer to the Code Analysis. Just rerun it. It will fix the error.</p>
</div>
</div>
<div class="sect3">
<h4 id="_failure_uploading_the_zap_proxy_report_into_the_upload_server">Failure uploading the zap proxy report into the upload server</h4>
<div class="paragraph">
<p>After the zap proxy task is executed the upload to the report repo server fails due to wrong folder structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+ ls -lhrt /zap/wrk
total 76K

-rw-r--r--. 1 zap zap 75K Aug 20 10:41 petclinic-build-devm9hqv.html
+ echo 'Uploading the report into the report server'
Uploading the report into the report server

+ curl -u reports:reports -F path=petclinic-build-devm9hqv.html -F file=/zap/wrk/petclinic-build-devm9hqv.html -X POST http://reports-repo:8080/upload
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
100   335  100    36  100   299   7200  59800 --:--:-- --:--:-- --:--:-- 67000
{"message":"Internal Server Error"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fix the zap-proxy task and replace the line 99, with the content of the following curl to upload properly</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>curl -u $(params.REPORTS_REPO_USERNAME):$(params.REPORTS_REPO_PASSWORD) -F path=$PIPELINERUN_NAME/$PIPELINERUN_NAME.html -F file=@/zap/wrk/$PIPELINERUN_NAME.html -X POST $(params.REPORTS_REPO_HOST)/upload; echo ""</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that rerun the pipeline and check that effectively the zap proxy report its uploaded to the reports server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+ curl -u reports:reports -F path=petclinic-build-dev-6f4569/petclinic-build-dev-6f4569.html -F file=@/zap/wrk/petclinic-build-dev-6f4569.html -X POST http://reports-repo:8080/upload
% Total % Received % Xferd Average Speed Time Time Time Current
Dload Upload Total Spent Left Speed

0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0
100 76435 100 89 100 76346 22250 18.2M --:File has been uploaded to petclinic-build-dev-6f4569/petclinic-build-dev-6f4569.html 🚀--:-- --:--:-- --:--:-- 18.2M
+ echo ''</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lab4-devsecops100.png" alt="300" width="700"></span></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-09-16 14:01:52 -0400
</div>
</div>
</body>
</html>